name: deploy

on:
  push:
    tags: -"v*"
    branches: [nextBlog] # nextBlog åˆ†æ”¯æœ‰ push æ—¶è§¦å‘
    paths-ignore: # ä¸‹åˆ—æ–‡ä»¶çš„å˜æ›´ä¸è§¦å‘éƒ¨ç½²ï¼Œå¯ä»¥è‡ªè¡Œæ·»åŠ 
      - README.md

permissions:
  contents: write # ç”¨äºè§£å†³github action permission deniedçš„é—®é¢˜

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # ä¸‹è½½æºç 
      # è¿™ä¸€æ­¥å°±æ˜¯æ£€å‡ºä½ çš„ä»“åº“å¹¶ä¸‹è½½é‡Œé¢çš„ä»£ç åˆ°runnerä¸­,actions/checkout@v2æ˜¯å®˜æ–¹è‡ªå·±é€ çš„è½®å­ï¼Œç›´æ¥æ‹¿æ¥ç”¨å°±è¡Œ
      - name: Checkout
        uses: actions/checkout@v2

      # æ‰“åŒ…æ„å»º
      - name: Build
        uses: actions/setup-node@master
        with:
          node-version: '^18.17.0'
      - name: å®‰è£… Pnpm ğŸ§¬
        uses: pnpm/action-setup@v2
        id: pnpm-install
        with:
          version: 7
          run_install: true

      - name: å®‰è£…ä¾èµ– âš™ï¸
        run: pnpm install
      - name: æ‰“åŒ… ğŸ—ï¸
        run: |
          pnpm run build
          touch out/.nojekyll
      # - run: npm install --legacy-peer-deps # å®‰è£…ä¾èµ–
      # - run: npm run build # æ‰“åŒ…

      # éƒ¨ç½²åˆ° GitHub pages
      - name: éƒ¨ç½² ğŸš€
        uses: peaceiris/actions-gh-pages@v3 # ä½¿ç”¨éƒ¨ç½²åˆ° GitHub pages çš„ action
        with:
          branch: gh-pages
          folder: out
          clean: true
          # publish_dir: ./out # éƒ¨ç½²æ‰“åŒ…åçš„ dist ç›®å½•
          # github_token: ${{ secrets.DEPLOY_SECRET }} # secret å
          # tag_name: ${{ steps.get_version.outputs.VERSION }}
          # release_name: ${{ steps.get_version.outputs.VERSION }}
          # personal_token: ${{secrets.ACTIONS_DEPLOY_KEY}}
